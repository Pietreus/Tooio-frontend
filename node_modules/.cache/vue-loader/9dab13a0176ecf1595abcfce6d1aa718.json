{"remainingRequest":"/home/pietreus/euvsvirus/Tooio/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/pietreus/euvsvirus/Tooio/client/src/components/OutgoingVideo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/pietreus/euvsvirus/Tooio/client/src/components/OutgoingVideo.vue","mtime":1587889430297},{"path":"/home/pietreus/euvsvirus/Tooio/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/pietreus/euvsvirus/Tooio/client/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/pietreus/euvsvirus/Tooio/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/pietreus/euvsvirus/Tooio/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBpbyBmcm9tICJzb2NrZXQuaW8tY2xpZW50IjsKdmFyIHNlc3Npb25EZXNjcmlwdGlvbiA9CiAgd2luZG93LlJUQ1Nlc3Npb25EZXNjcmlwdGlvbiB8fAogIHdpbmRvdy5tb3pSVENTZXNzaW9uRGVzY3JpcHRpb24gfHwKICB3aW5kb3cud2Via2l0UlRDU2Vzc2lvbkRlc2NyaXB0aW9uIHx8CiAgd2luZG93Lm1zUlRDU2Vzc2lvbkRlc2NyaXB0aW9uOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIk91dGdvaW5nVmlkZW9zIiwKICBwcm9wczogewogICAgbXNnOiBTdHJpbmcKICB9LAogIGRhdGE6ICgpID0+ICh7CiAgICBleGlzdGluZ1N0cmVhbXM6IFtdLAogICAgc29ja2V0OiB7fSwKICAgIGxvY2FsU3RyZWFtOiBudWxsLAogICAgcGM6IHt9LAogICAgYW5zd2Vyc0Zyb206IHt9LAogICAgaWNlQ29uZmlndXJhdGlvbjogewogICAgICBpY2VTZXJ2ZXJzOiBbCiAgICAgICAgewogICAgICAgICAgdXJsczogWyJzdHVuOnN0dW4uc2NobHVuZC5kZSJdCiAgICAgICAgfQogICAgICBdCiAgICB9CiAgfSksCiAgbWV0aG9kczogewogICAgc2V0dXBMb2NhbFN0cmVhbTogYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgIGNvbnN0IHZpZGVvQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZGVvQ29udGFpbmVyIik7CiAgICAgIHZpZGVvQ29udGFpbmVyLnNyY09iamVjdCA9IHRoaXMubG9jYWxTdHJlYW07CiAgICAgIHZpZGVvQ29udGFpbmVyLm9ubG9hZGVkbWV0YWRhdGEgPSBmdW5jdGlvbigpIHsKICAgICAgICB2aWRlb0NvbnRhaW5lci5wbGF5KCk7CiAgICAgIH07CiAgICB9LAogICAgc2V0dXBTb2NrZXRzOiBhc3luYyBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5zb2NrZXQub24oImFkZC11c2VycyIsIHRoaXMub25BZGRVc2Vycyk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKCJvZmZlci1tYWRlIiwgdGhpcy5vbk9mZmVyTWFkZSk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKCJhbnN3ZXItbWFkZSIsIHRoaXMub25BbnN3ZXJNYWRlKTsKICAgIH0sCiAgICBlcnJvckhhbmRsZXI6IGZ1bmN0aW9uKGVycikgewogICAgICBjb25zb2xlLndhcm4oIkVycm9yIiwgZXJyKTsKICAgIH0sCiAgICBjcmVhdGVPZmZlcjogZnVuY3Rpb24oaWQpIHsKICAgICAgdGhpcy5wY1tpZF0uY3JlYXRlT2ZmZXIob2ZmZXIgPT4gewogICAgICAgIHRoaXMucGNbaWRdLnNldExvY2FsRGVzY3JpcHRpb24oCiAgICAgICAgICBuZXcgc2Vzc2lvbkRlc2NyaXB0aW9uKG9mZmVyKSwKICAgICAgICAgICgpID0+IHsKICAgICAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCgibWFrZS1vZmZlciIsIHsKICAgICAgICAgICAgICBvZmZlcjogb2ZmZXIsCiAgICAgICAgICAgICAgdG86IGlkCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyCiAgICAgICAgKTsKICAgICAgfSwgdGhpcy5lcnJvckhhbmRsZXIpOwogICAgfSwKICAgIG9uQWRkVXNlcnM6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgY29uc29sZS5sb2coImFkZHVzZXJzIiwgZGF0YSk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS51c2Vycy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLAogICAgICAgICAgaWQgPSBkYXRhLnVzZXJzW2ldOwoKICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoImlkIiwgaWQpOwogICAgICAgIGVsLmlubmVySFRNTCA9IGlkOwogICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgICAgdGhpcy5hZGRQZWVyQ29ubmVjdGlvbihpZCkKICAgICAgICAgIHRoaXMuY3JlYXRlT2ZmZXIoaWQpOwogICAgICAgIH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VycyIpLmFwcGVuZENoaWxkKGVsKTsKICAgICAgfQogICAgfSwKICAgIG9uQW5zd2VyTWFkZTogZnVuY3Rpb24oZGF0YSkgewogICAgICBjb25zb2xlLmxvZygiYW5zd2VybWFkZSIsIGRhdGEpOwoKICAgICAgdGhpcy5wY1tkYXRhLnNvY2tldF0uc2V0UmVtb3RlRGVzY3JpcHRpb24oCiAgICAgICAgbmV3IHNlc3Npb25EZXNjcmlwdGlvbihkYXRhLmFuc3dlciksCiAgICAgICAgKCkgPT4gewogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGF0YS5zb2NrZXQpLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAiYWN0aXZlIik7CiAgICAgICAgICBpZiAoIXRoaXMuYW5zd2Vyc0Zyb21bZGF0YS5zb2NrZXRdKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlT2ZmZXIoZGF0YS5zb2NrZXQpOwogICAgICAgICAgICB0aGlzLmFuc3dlcnNGcm9tW2RhdGEuc29ja2V0XSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB0aGlzLmVycm9ySGFuZGxlcgogICAgICApOwogICAgfSwKICAgIG9uT2ZmZXJNYWRlOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgIGNvbnNvbGUubG9nKCJvZmZlcm1hZGUiLCBkYXRhKTsKICAgICAgdGhpcy5hZGRQZWVyQ29ubmVjdGlvbihkYXRhLnNvY2tldCkKICAgICAgdGhpcy5wY1tkYXRhLnNvY2tldF0uc2V0UmVtb3RlRGVzY3JpcHRpb24oCiAgICAgICAgbmV3IHNlc3Npb25EZXNjcmlwdGlvbihkYXRhLm9mZmVyKSwKICAgICAgICAoKSA9PiB7CiAgICAgICAgICB0aGlzLnBjW2RhdGEuc29ja2V0XS5jcmVhdGVBbnN3ZXIoYW5zd2VyID0+IHsKICAgICAgICAgICAgdGhpcy5wY1tkYXRhLnNvY2tldF0uc2V0TG9jYWxEZXNjcmlwdGlvbigKICAgICAgICAgICAgICBuZXcgc2Vzc2lvbkRlc2NyaXB0aW9uKGFuc3dlciksCiAgICAgICAgICAgICAgKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCgibWFrZS1hbnN3ZXIiLCB7CiAgICAgICAgICAgICAgICAgIGFuc3dlcjogYW5zd2VyLAogICAgICAgICAgICAgICAgICB0bzogZGF0YS5zb2NrZXQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGhpcy5lcnJvckhhbmRsZXIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0sIHRoaXMuZXJyb3JIYW5kbGVyKTsKICAgICAgICB9LAogICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyCiAgICAgICk7CiAgICB9LAogICAgYWRkUGVlckNvbm5lY3Rpb246IGZ1bmN0aW9uKGlkKSB7CiAgICAgIHZhciBwZWVyQ29ubmVjdGlvbiA9CiAgICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uIHx8CiAgICAgICAgd2luZG93Lm1velJUQ1BlZXJDb25uZWN0aW9uIHx8CiAgICAgICAgd2luZG93LndlYmtpdFJUQ1BlZXJDb25uZWN0aW9uIHx8CiAgICAgICAgd2luZG93Lm1zUlRDUGVlckNvbm5lY3Rpb247CiAgICAgIGNvbnN0IG5ld0Nvbm5lY3Rpb24gPSBuZXcgcGVlckNvbm5lY3Rpb24odGhpcy5pY2VDb25maWd1cmF0aW9uKTsKICAgICAgbmV3Q29ubmVjdGlvbi5vbnRyYWNrID0gb2JqID0+IHsKICAgICAgICBjb25zdCB2aWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ2aWRlbyIpOwogICAgICAgIHZpZC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgInZpZGVvLXNtYWxsIik7CiAgICAgICAgdmlkLnNldEF0dHJpYnV0ZSgiYXV0b3BsYXkiLCAiYXV0b3BsYXkiKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlcnMtY29udGFpbmVyIikuYXBwZW5kQ2hpbGQodmlkKTsKICAgICAgICB2aWQuc3JjT2JqZWN0ID0gb2JqLnN0cmVhbXNbMF07CiAgICAgIH07CiAgICAgIG5ld0Nvbm5lY3Rpb24uYWRkU3RyZWFtKHRoaXMubG9jYWxTdHJlYW0pOwogICAgICB0aGlzLnBjW2lkXSA9IG5ld0Nvbm5lY3Rpb247CiAgICB9CiAgfSwKICBtb3VudGVkOiBhc3luYyBmdW5jdGlvbigpIHsKICAgIHRoaXMuc29ja2V0ID0gaW8uY29ubmVjdCgiaHR0cDovLzE5Mi4xNjguMC4xMDg6NTAwMCIpOwoKICAgIG5hdmlnYXRvci5nZXRVc2VyTWVkaWEgPQogICAgICBuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhIHx8CiAgICAgIG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEgfHwKICAgICAgbmF2aWdhdG9yLm1vekdldFVzZXJNZWRpYSB8fAogICAgICBuYXZpZ2F0b3IubXNHZXRVc2VyTWVkaWE7CiAgICBjb25zb2xlLmxvZyhuYXZpZ2F0b3IpCiAgICB0aGlzLmxvY2FsU3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoewogICAgICBhdWRpbzogdHJ1ZSwKICAgICAgdmlkZW86IHRydWUKICAgIH0pOwoKICAgIGF3YWl0IHRoaXMuc2V0dXBMb2NhbFN0cmVhbSgpOwogICAgdGhpcy5hZGRQZWVyQ29ubmVjdGlvbih0aGlzLnNvY2tldC5pZCk7CiAgICBhd2FpdCB0aGlzLnNldHVwU29ja2V0cygpOwogIH0KfTsK"},{"version":3,"sources":["OutgoingVideo.vue"],"names":[],"mappings":";;;;;;;;;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"OutgoingVideo.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"hello\">\n    <video id=\"videoContainer\" ref=\"videoContainer\"></video>\n    <div id=\"users-container\"></div>\n    <div id=\"users\"></div>\n  </div>\n</template>\n\n<script>\nimport io from \"socket.io-client\";\nvar sessionDescription =\n  window.RTCSessionDescription ||\n  window.mozRTCSessionDescription ||\n  window.webkitRTCSessionDescription ||\n  window.msRTCSessionDescription;\nexport default {\n  name: \"OutgoingVideos\",\n  props: {\n    msg: String\n  },\n  data: () => ({\n    existingStreams: [],\n    socket: {},\n    localStream: null,\n    pc: {},\n    answersFrom: {},\n    iceConfiguration: {\n      iceServers: [\n        {\n          urls: [\"stun:stun.schlund.de\"]\n        }\n      ]\n    }\n  }),\n  methods: {\n    setupLocalStream: async function() {\n      const videoContainer = document.getElementById(\"videoContainer\");\n      videoContainer.srcObject = this.localStream;\n      videoContainer.onloadedmetadata = function() {\n        videoContainer.play();\n      };\n    },\n    setupSockets: async function() {\n      this.socket.on(\"add-users\", this.onAddUsers);\n      this.socket.on(\"offer-made\", this.onOfferMade);\n      this.socket.on(\"answer-made\", this.onAnswerMade);\n    },\n    errorHandler: function(err) {\n      console.warn(\"Error\", err);\n    },\n    createOffer: function(id) {\n      this.pc[id].createOffer(offer => {\n        this.pc[id].setLocalDescription(\n          new sessionDescription(offer),\n          () => {\n            this.socket.emit(\"make-offer\", {\n              offer: offer,\n              to: id\n            });\n          },\n          this.errorHandler\n        );\n      }, this.errorHandler);\n    },\n    onAddUsers: function(data) {\n      console.log(\"addusers\", data);\n      for (var i = 0; i < data.users.length; i++) {\n        var el = document.createElement(\"div\"),\n          id = data.users[i];\n\n        el.setAttribute(\"id\", id);\n        el.innerHTML = id;\n        el.addEventListener(\"click\", () => {\n          this.addPeerConnection(id)\n          this.createOffer(id);\n        });\n        document.getElementById(\"users\").appendChild(el);\n      }\n    },\n    onAnswerMade: function(data) {\n      console.log(\"answermade\", data);\n\n      this.pc[data.socket].setRemoteDescription(\n        new sessionDescription(data.answer),\n        () => {\n          document.getElementById(data.socket).setAttribute(\"class\", \"active\");\n          if (!this.answersFrom[data.socket]) {\n            this.createOffer(data.socket);\n            this.answersFrom[data.socket] = true;\n          }\n        },\n        this.errorHandler\n      );\n    },\n    onOfferMade: function(data) {\n      console.log(\"offermade\", data);\n      this.addPeerConnection(data.socket)\n      this.pc[data.socket].setRemoteDescription(\n        new sessionDescription(data.offer),\n        () => {\n          this.pc[data.socket].createAnswer(answer => {\n            this.pc[data.socket].setLocalDescription(\n              new sessionDescription(answer),\n              () => {\n                this.socket.emit(\"make-answer\", {\n                  answer: answer,\n                  to: data.socket\n                });\n              },\n              this.errorHandler\n            );\n          }, this.errorHandler);\n        },\n        this.errorHandler\n      );\n    },\n    addPeerConnection: function(id) {\n      var peerConnection =\n        window.RTCPeerConnection ||\n        window.mozRTCPeerConnection ||\n        window.webkitRTCPeerConnection ||\n        window.msRTCPeerConnection;\n      const newConnection = new peerConnection(this.iceConfiguration);\n      newConnection.ontrack = obj => {\n        const vid = document.createElement(\"video\");\n        vid.setAttribute(\"class\", \"video-small\");\n        vid.setAttribute(\"autoplay\", \"autoplay\");\n        document.getElementById(\"users-container\").appendChild(vid);\n        vid.srcObject = obj.streams[0];\n      };\n      newConnection.addStream(this.localStream);\n      this.pc[id] = newConnection;\n    }\n  },\n  mounted: async function() {\n    this.socket = io.connect(\"http://192.168.0.108:5000\");\n\n    navigator.getUserMedia =\n      navigator.getUserMedia ||\n      navigator.webkitGetUserMedia ||\n      navigator.mozGetUserMedia ||\n      navigator.msGetUserMedia;\n    console.log(navigator)\n    this.localStream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true\n    });\n\n    await this.setupLocalStream();\n    this.addPeerConnection(this.socket.id);\n    await this.setupSockets();\n  }\n};\n</script>\n\n<style scoped>\n</style>\n"]}]}